# ozie.tonary.biz - Next Engine Integration Tool
# eca.tonary.biz サーバー上の /etc/nginx/conf.d/ に配置
#
# 初回デプロイ手順:
# 1. sudo cp docker/nginx/ozie.tonary.biz.conf /etc/nginx/conf.d/
# 2. sudo nginx -t
# 3. sudo systemctl reload nginx
# 4. sudo certbot --nginx -d ozie.tonary.biz  ← SSL設定が自動追加される

server {
    listen 80;
    server_name ozie.tonary.biz;

    # リバースプロキシ設定 - Dockerコンテナ(localhost:8003)へ転送
    location / {
        proxy_pass http://127.0.0.1:8003;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # PHP実行時間が長い場合に備えてタイムアウト延長
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
    }

    # アクセスログ・エラーログ
    error_log  /var/log/nginx/ozie.tonary.biz.error.log;
    access_log /var/log/nginx/ozie.tonary.biz.access.log;
}
